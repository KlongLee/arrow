version: '3'
services:

  ######################### Language Containers ###############################

  go:
    image: arrow:go
    build:
      context: .
      dockerfile: go/Dockerfile

  rust:
    image: arrow:rust
    build:
      context: .
      dockerfile: rust/Dockerfile

  cpp:
    image: arrow:cpp
    build:
      context: .
      dockerfile: cpp/Dockerfile

  python:
    image: arrow:python-${PYTHON_VERSION:-3.6}
    build:
      context: .
      dockerfile: python/Dockerfile
      args:
        PYTHON_VERSION: ${PYTHON_VERSION:-3.6}

  ######################### Integration Tests #################################

  # impala:
  #   image: cpcloud86/impala:java8-1
  #   ports:
  #     - "21050"
  #   hostname: impala

  hdfs-namenode:
    image: gelog/hadoop
    shm_size: 2G
    ports:
      - "9000:9000"
      - "50070:50070"
    command: hdfs namenode
    hostname: hdfs-namenode

  hdfs-datanode:
    image: gelog/hadoop
    command: hdfs datanode
    ports:
      # The host port is randomly assigned by Docker, to allow scaling
      # to multiple DataNodes on the same host
      - "50075"
    links:
      - hdfs-namenode:hdfs-namenode

  hdfs-integration:
    links:
      - hdfs-namenode:hdfs-namenode
      - hdfs-datanode:hdfs-datanode
    environment:
      - ARROW_HDFS_TEST_HOST=hdfs-namenode
      - ARROW_HDFS_TEST_PORT=9000
      - ARROW_HDFS_TEST_USER=root
    build:
      context: .
      dockerfile: integration/hdfs/Dockerfile

  # TODO(kszucs): dask-integration
  # TODO(kszucs): hive-integration
  # TODO(kszucs): spark-integration

  ######################### Documentation #####################################

  # TODO(kszucs): site
  # TODO(kszucs): apidoc
